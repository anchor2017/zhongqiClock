C51 COMPILER V8.08   CALTIMEDISPLAY                                                        07/24/2017 11:01:10 PAGE 1   


C51 COMPILER V8.08, COMPILATION OF MODULE CALTIMEDISPLAY
OBJECT MODULE PLACED IN calTimeDisplay.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE calTimeDisplay.c OPTIMIZE(9,SIZE) BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /***************************************************************************************
   2           *      FileName                                        :       calTimeDisplay.c
   3           *      CopyRight                                       : 
   4           *      ModuleName                                      :        
   5           *
   6           *      CPU                                                     :
   7           *      RTOS                                            :
   8           *
   9           *      Create Data                                     :       
  10           *      Author/Corportation                     :        caiyinmao
  11           *
  12           *      Abstract Description            :
  13           *
  14           *--------------------------------Revision History--------------------------------------
  15           *      No      version         Data                    Revised By                      Item                    Description
  16           *      
  17           *
  18           ***************************************************************************************/
  19          
  20          
  21          /**************************************************************
  22          *       Debug switch Section
  23          **************************************************************/
  24          
  25          
  26          /**************************************************************
  27          *       Include File Section
  28          **************************************************************/
  29          
  30          #include "calTimeDisplay.h"
  31          #include "touch.h"
  32          #include "paintTFT.h"
  33          #include "lcd_driver.h"
  34          #include "clock.h"              //引用全局变量time
  35          
  36          /**************************************************************
  37          *       Macro Define Section
  38          **************************************************************/
  39          
  40          /**************************************************************
  41          *       Struct Define Section
  42          **************************************************************/
  43          
  44          
  45          /**************************************************************
  46          *       Prototype Declare Section
  47          **************************************************************/
  48          
  49          
  50          /**************************************************************
  51          *       Global Variable Declare Section
  52          **************************************************************/
  53          
  54          
  55          /**************************************************************
C51 COMPILER V8.08   CALTIMEDISPLAY                                                        07/24/2017 11:01:10 PAGE 2   

  56          *       File Static Variable Define Section
  57          **************************************************************/
  58          
  59          /**************************************************************
  60          *       Function Define Section
  61          **************************************************************/
  62          
  63          /**
  64          *  @name:void calTimeDisplay();
  65          *       @description: 主时钟显示及时钟调整设置
  66           *      @param          :none
  67           *      @return         : none
  68           *  @notice : none
  69           */
  70          void CalTimeDisplay()    
  71          {               
  72   1              /*进入主时钟界面*/
  73   1              if(back==1)
  74   1              {
  75   2                      if(anotherSur==1)               //判断是否要清屏
  76   2                      {
  77   3                              TFT_ClearScreen(0x0000);                //清屏
  78   3                              anotherSur=0;           //如果不是设置界面返回则不需要清屏
  79   3                      }
  80   2                      
  81   2                      /*触摸屏上主时钟界面的显示*/
  82   2                      //
  83   2                      while(TOUCH_XPT_ReadXY() != 1)
  84   2                      {
  85   3                              TFT_paintMainClock();
  86   3                      }
  87   2      
  88   2                      back=0;            //不再进入时钟界面但是屏幕并不清除
  89   2                      clockFlag=1;    //如果在时钟界面则时钟界面的触屏有效
  90   2                      setFlag=0;         //如果在时钟界面则设置界面的触屏无效
  91   2                      i=0;            //每次重新进入设置页面都从小时开始调整
  92   2              }
  93   1              /*进入设置界面*/
  94   1              if(set==1)              
  95   1              {       
  96   2                      /*线条及数字的基本框图*/                
  97   2                      TFT_paintSetSur();
  98   2                      /*将时间写在设置界面左偏上*/     
  99   2                      TFT_paintTimeSet();
 100   2                                               
 101   2                      set = 0;
 102   2                      clockFlag=0;       //如果在设置界面则时钟界面的触屏无效
 103   2                      setFlag=1;         //如果在设置界面则设置界面的触屏有效
 104   2                      anotherSur=1;   //从设置界面返回主时钟界面需要清屏
 105   2              }
 106   1              /*触摸检测*/
 107   1              if(TOUCH_XPT_ReadXY() == 1)             
 108   1              {
 109   2                      /*转化*/
 110   2                      x=xpt_xy.x;
 111   2                      x=(x-304)*175/3422;
 112   2                      y=xpt_xy.y;
 113   2                      y=(y-256)*219/3440;                     
 114   2                      if(x>174)
 115   2                      {
 116   3                              x=174;
 117   3                      }
C51 COMPILER V8.08   CALTIMEDISPLAY                                                        07/24/2017 11:01:10 PAGE 3   

 118   2                      if(y>218)
 119   2                      {
 120   3                              y=218;
 121   3                      }                       
 122   2      
 123   2                      /*屏上功能部分检测反应（时钟页面）*/     //不需要清屏
 124   2                      if(clockFlag==1)
 125   2                      {
 126   3                              if((x>115)&&(y<24))
 127   3                              {
 128   4                                      set=1;            //右上角
 129   4                              }
 130   3                      }
 131   2      
 132   2                      /*屏上功能部分检测反应（设置页面）一旦进入设置页面就停止走时，进入主时钟界面开始走时*/   //不需要清屏
 133   2                      if(setFlag==1)
 134   2                      {
 135   3                              ET0=0;          //关闭定时器，停止走时
 136   3                              /*屏上数字部分检测（设置页面）*/         //不需要清屏                                           
 137   3                              if((x>115)&&(y>45)&&(y<85))       //0
 138   3                              {
 139   4                                      TimeArray[i]=0;
 140   4                                      i++;
 141   4      
 142   4                                      /*重新设定的时间显示*/
 143   4                                      time.hour=TimeArray[0]*10+TimeArray[1]; 
 144   4                                      time.minute=TimeArray[2]*10+TimeArray[3];
 145   4                                      time.second=TimeArray[4]*10+TimeArray[5];
 146   4                                      TFT_paintTimeSet();
 147   4                              }
 148   3                              if((x<60)&&(y>95)&&(y<135))       //1
 149   3                              {
 150   4                                      TimeArray[i]=1;
 151   4                                      i++;
 152   4      
 153   4                                      /*重新设定的时间显示*/
 154   4                                      time.hour=TimeArray[0]*10+TimeArray[1]; 
 155   4                                      time.minute=TimeArray[2]*10+TimeArray[3];
 156   4                                      time.second=TimeArray[4]*10+TimeArray[5]; 
 157   4                                      TFT_paintTimeSet();
 158   4                              }
 159   3                              if((x>70)&&(x<105)&&(y>95)&&(y<135)) //2
 160   3                              {
 161   4                                      TimeArray[i]=2;
 162   4                                      i++;
 163   4      
 164   4                                      /*重新设定的时间显示*/
 165   4                                      time.hour=TimeArray[0]*10+TimeArray[1]; 
 166   4                                      time.minute=TimeArray[2]*10+TimeArray[3];
 167   4                                      time.second=TimeArray[4]*10+TimeArray[5];
 168   4                                      TFT_paintTimeSet();
 169   4                              }
 170   3                              if((x>115)&&(y>95)&&(y<135))  //3
 171   3                              {
 172   4                                      oriTime=TimeArray[i];
 173   4                                      TimeArray[i]=3;
 174   4                                      i++;                            
 175   4      
 176   4                                      if(i==1)                 //时间校准限制
 177   4                                      {
 178   5                                              i--;
 179   5                                              TimeArray[i]=oriTime; 
C51 COMPILER V8.08   CALTIMEDISPLAY                                                        07/24/2017 11:01:10 PAGE 4   

 180   5                                      }
 181   4      
 182   4                                      /*重新设定的时间显示*/
 183   4                                      time.hour=TimeArray[0]*10+TimeArray[1]; 
 184   4                                      time.minute=TimeArray[2]*10+TimeArray[3];
 185   4                                      time.second=TimeArray[4]*10+TimeArray[5];
 186   4                                      TFT_paintTimeSet();
 187   4                              }
 188   3                              if((x<60)&&(y>145)&&(y<165))      //4
 189   3                              {
 190   4                                      oriTime=TimeArray[i];
 191   4                                      TimeArray[i]=4;
 192   4                                      i++;                            
 193   4      
 194   4                                      if(i==1)                 //时间校准限制
 195   4                                      {
 196   5                                              i--;
 197   5                                              TimeArray[i]=oriTime;  
 198   5                                      }
 199   4      
 200   4                                      /*重新设定的时间显示*/
 201   4                                      time.hour=TimeArray[0]*10+TimeArray[1]; 
 202   4                                      time.minute=TimeArray[2]*10+TimeArray[3];
 203   4                                      time.second=TimeArray[4]*10+TimeArray[5];        
 204   4                                      TFT_paintTimeSet();
 205   4                              }
 206   3                              if((x>70)&&(x<105)&&(y>145)&&(y<165)) //5
 207   3                              {
 208   4                                      oriTime=TimeArray[i];
 209   4                                      TimeArray[i]=5;
 210   4                                      i++;                            
 211   4      
 212   4                                      if(i==1)                   //时间校准限制
 213   4                                      {
 214   5                                              i--;
 215   5                                              TimeArray[i]=oriTime;
 216   5                                      }
 217   4                                      if((TimeArray[0]==2) && (i==2))
 218   4                                      {
 219   5                                              i--;
 220   5                                              TimeArray[i]=oriTime;  
 221   5                                      }
 222   4      
 223   4                                      /*重新设定的时间显示*/
 224   4                                      time.hour=TimeArray[0]*10+TimeArray[1]; 
 225   4                                      time.minute=TimeArray[2]*10+TimeArray[3];
 226   4                                      time.second=TimeArray[4]*10+TimeArray[5];        
 227   4                                      TFT_paintTimeSet();
 228   4                              }
 229   3                              if((x>115)&&(y>145)&&(y<165)) //6
 230   3                              {
 231   4                                      oriTime=TimeArray[i];
 232   4                                      TimeArray[i]=6;
 233   4                                      i++;                            
 234   4      
 235   4                                      if((i==1) || (i==3) || (i==5))          //时间校准限制
 236   4                                      {
 237   5                                              i--;
 238   5                                              TimeArray[i]=oriTime;
 239   5                                      }
 240   4                                      if((TimeArray[0]==2) && (i==2))
 241   4                                      {
C51 COMPILER V8.08   CALTIMEDISPLAY                                                        07/24/2017 11:01:10 PAGE 5   

 242   5                                              i--;
 243   5                                              TimeArray[i]=oriTime;
 244   5                                      }
 245   4      
 246   4                                      /*重新设定的时间显示*/
 247   4                                      time.hour=TimeArray[0]*10+TimeArray[1]; 
 248   4                                      time.minute=TimeArray[2]*10+TimeArray[3];
 249   4                                      time.second=TimeArray[4]*10+TimeArray[5];
 250   4                                      TFT_paintTimeSet();
 251   4                              }
 252   3                              if((x<60)&&(y>175)&(y<205))       //7
 253   3                              {
 254   4                                      oriTime=TimeArray[i];
 255   4                                      TimeArray[i]=7;
 256   4                                      i++;
 257   4      
 258   4                                      if((i==1) || (i==3) || (i==5))          //时间校准限制
 259   4                                      {
 260   5                                              i--;
 261   5                                              TimeArray[i]=oriTime;
 262   5                                      }
 263   4                                      if((TimeArray[0]==2) && (i==2))
 264   4                                      {
 265   5                                              i--;
 266   5                                              TimeArray[i]=oriTime;
 267   5                                      }
 268   4      
 269   4                                      /*重新设定的时间显示*/
 270   4                                      time.hour=TimeArray[0]*10+TimeArray[1]; 
 271   4                                      time.minute=TimeArray[2]*10+TimeArray[3];
 272   4                                      time.second=TimeArray[4]*10+TimeArray[5];        
 273   4                                      TFT_paintTimeSet();
 274   4                              }
 275   3                              if((x>70)&&(x<105)&&(y>175)&&(y<205)) //8
 276   3                              {
 277   4                                      oriTime=TimeArray[i];
 278   4                                      TimeArray[i]=8;
 279   4                                      i++;
 280   4      
 281   4                                      if((i==1) || (i==3) || (i==5))           //时间校准限制
 282   4                                      {
 283   5                                              i--;
 284   5                                              TimeArray[i]=oriTime;
 285   5                                      }
 286   4                                      if((TimeArray[0]==2) && (i==2))
 287   4                                      {
 288   5                                              i--;
 289   5                                              TimeArray[i]=oriTime;
 290   5                                      }
 291   4      
 292   4                                      /*重新设定的时间显示*/
 293   4                                      time.hour=TimeArray[0]*10+TimeArray[1]; 
 294   4                                      time.minute=TimeArray[2]*10+TimeArray[3];
 295   4                                      time.second=TimeArray[4]*10+TimeArray[5]; 
 296   4                                      TFT_paintTimeSet();
 297   4                              }
 298   3                              if((x>115)&&(y>175)&&(y<205)) //9
 299   3                              {
 300   4                                      oriTime=TimeArray[i];
 301   4                                      TimeArray[i]=9;
 302   4                                      i++;
 303   4      
C51 COMPILER V8.08   CALTIMEDISPLAY                                                        07/24/2017 11:01:10 PAGE 6   

 304   4                                      if((i==1) || (i==3) || (i==5))     //时间校准限制
 305   4                                      {
 306   5                                              i--;
 307   5                                              TimeArray[i]=oriTime;
 308   5                                      }
 309   4                                      if((TimeArray[0]==2) && (i==2))
 310   4                                      {
 311   5                                              i--;
 312   5                                              TimeArray[i]=oriTime;
 313   5                                      }
 314   4      
 315   4                                      /*重新设定的时间显示*/
 316   4                                      time.hour=TimeArray[0]*10+TimeArray[1]; 
 317   4                                      time.minute=TimeArray[2]*10+TimeArray[3];
 318   4                                      time.second=TimeArray[4]*10+TimeArray[5]; 
 319   4                                      TFT_paintTimeSet();
 320   4                              }
 321   3                                                      
 322   3                              if(i==6)        //如果时分秒都赋值完毕则可以重新赋值
 323   3                              {
 324   4                                      i=0;
 325   4                              }
 326   3      
 327   3                              if((x<55)&&(y<24))       //左上角
 328   3                              {
 329   4                                      back=1;
 330   4                                      ET0=1;             
 331   4                              }
 332   3                      }                               
 333   2              } //触摸检测
 334   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1105    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
