C51 COMPILER V9.56.0.0   CALTIMEDISPLAY                                                    07/25/2017 16:46:23 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE CALTIMEDISPLAY
OBJECT MODULE PLACED IN .\Objects\calTimeDisplay.obj
COMPILER INVOKED BY: F:\keil51\C51\BIN\C51.EXE calTimeDisplay.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\List
                    -ings\calTimeDisplay.lst) TABS(2) OBJECT(.\Objects\calTimeDisplay.obj)

line level    source

   1          /***************************************************************************************
   2           *  FileName          : calTimeDisplay.c
   3           *  CopyRight         : 
   4           *  ModuleName          :  
   5           *
   6           *  CPU             :
   7           *  RTOS            :
   8           *
   9           *  Create Data         : 
  10           *  Author/Corportation     :  caiyinmao
  11           *
  12           *  Abstract Description    :  显示界面
  13           *
  14           *--------------------------------Revision History--------------------------------------
  15           *  No  version   Data      Revised By      Item      Description
  16           *  
  17           *
  18           ***************************************************************************************/
  19          
  20          
  21          /**************************************************************
  22          * Debug switch Section
  23          **************************************************************/
  24          
  25          
  26          /**************************************************************
  27          * Include File Section
  28          **************************************************************/
  29          
  30          #include "calTimeDisplay.h"
  31          #include "touch.h"
  32          #include "paintTFT.h"
  33          #include "GUI.h"
  34          #include "lcd_driver.h"
  35          #include "clock.h"    //引用全局变量time
  36          #include"AD.H"
  37          #include"gy521.h"
  38          /**************************************************************
  39          * Macro Define Section
  40          **************************************************************/
  41          
  42          /**************************************************************
  43          * Struct Define Section
  44          **************************************************************/
  45          
  46          
  47          /**************************************************************
  48          * Prototype Declare Section
  49          **************************************************************/
  50          sbit PWM = P3^5; 
  51          
  52          /**************************************************************
  53          * Global Variable Declare Section
  54          **************************************************************/
C51 COMPILER V9.56.0.0   CALTIMEDISPLAY                                                    07/25/2017 16:46:23 PAGE 2   

  55          
  56          
  57          /**************************************************************
  58          * File Static Variable Define Section
  59          **************************************************************/
  60          
  61          /**************************************************************
  62          * Function Define Section
  63          **************************************************************/
  64          
  65          
  66          /**
  67          *  @name:void displayPageSet()
  68          * @description: 显示设置时间界面
  69           *  @param    :none
  70           *  @return   : none
  71           *  @notice : none
  72           */
  73          void displayPageSetTime()
  74          {
  75   1          /*线条及数字的基本框图*/    
  76   1          TFT_paintSetSur("TIME");
  77   1          /*将时间写在设置界面左偏上*/   
  78   1          TFT_paintTimeSet(time);          
  79   1          setTime();        //设置时间
  80   1      }
  81          
  82          /**
  83          *  @name:void displayPageSetClock()
  84          * @description: 显示设置闹钟界面
  85           *  @param    :none
  86           *  @return   : none
  87           *  @notice : none
  88           */
  89          void displayPageSetClock()
  90          {
  91   1          /*线条及数字的基本框图*/    
  92   1          TFT_paintSetSur("CLOCK");
  93   1        GUI_WriteASCII(99,0, "YES", 0x07E0, 0x0000);  
  94   1          /*将时间写在设置界面左偏上*/   
  95   1          TFT_paintTimeSet(timeclock);            
  96   1          setClockTime();
  97   1      }
  98          
  99          
 100          
 101          /**
 102          *  @name: displayPageSetting
 103          * @description: 显示设置界面
 104           *  @param    :none
 105           *  @return   : none
 106           *  @notice : none
 107           */
 108          void displayPageSetting()
 109          {
 110   1        TFT_ClearScreen(0x0000);    //清屏  
 111   1        GUI_WriteASCII(0,0, "BACK", 0x001F, 0x0000);  
 112   1        GUI_WriteASCII(50,24, "SET", 0xFFE0, 0x0000);
 113   1        GUI_WriteASCII(50, 94, "TIME", 0x7ff, 0x0000);  
 114   1        GUI_WriteASCII(50, 134, "CLOCK", 0x7fff, 0x0000); 
 115   1        GUI_Line(20, 50, 155, 50, 0xF800);     //画横线
 116   1        GUI_Line(20, 130, 155, 130, 0xF800);  //x, y, x, y
C51 COMPILER V9.56.0.0   CALTIMEDISPLAY                                                    07/25/2017 16:46:23 PAGE 3   

 117   1        GUI_Line(20, 170, 155, 170, 0xF800);  //x, y, x, y
 118   1        while(1) 
 119   1         {
 120   2          if(TOUCH_XPT_ReadXY() == 1)   
 121   2          {
 122   3            /*转化*/
 123   3            x=xpt_xy.x;
 124   3            x=(x-304)*175/3422;
 125   3            y=xpt_xy.y;
 126   3            y=(y-256)*219/3440;     
 127   3            if(x>174)
 128   3            {
 129   4              x=174;
 130   4            }
 131   3            if(y>218)
 132   3            {
 133   4                y=218;
 134   4            }
 135   3            if( y < 135 && y > 95)       //选择设置时间
 136   3            {
 137   4              displayPageSetTime();
 138   4              TFT_ClearScreen(0x0000);    //清屏
 139   4              break;   //退出循环 
 140   4            }
 141   3            else if( y > 135 && y < 165)   // 选择设置闹钟
 142   3            {
 143   4              displayPageSetClock();
 144   4            TFT_ClearScreen(0x0000);    //清屏
 145   4              break;   //退出循环 
 146   4            }
 147   3            else if((x<55)&&(y<24))  //左上角
 148   3            {
 149   4            TFT_ClearScreen(0x0000);    //清屏
 150   4              break;   //退出循环       
 151   4            }
 152   3          }
 153   2        }   
 154   1      }
 155          
 156          /**
 157          *  @name:void displayTemp(int temp)  
 158          * @description: 显示温度
 159           *  @param    :temp = 温度 x 10
 160           *  @return   : none
 161           *  @notice : none
 162           */
 163          void displayTemp(int temp)   
 164          {
 165   1         uchar code table[] ={
 166   1      0x38,0x00,0x6C,0x00,0xC6,0x00,0x82,0x00,0xC6,0x00,0x6C,0x00,0x38,0xFE,0x01,0xFE,
 167   1      0x07,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0C,0x00,0x0C,0x00,0x0C,0x00,0x0C,0x00,
 168   1      0x0E,0x00,0x0E,0x00,0x06,0x00,0x03,0xFE,0x00,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,
 169   1         };       //摄氏度     
 170   1         uchar color,k,j,stemp[][2]= { 0, '\0', 0, '\0', '.', '\0', 0,  '\0'};
 171   1         stemp[0][0] = temp / 100 + '0';     
 172   1         stemp[1][0] = (temp % 100) / 10 + '0';
 173   1         stemp[3][0] = temp % 10 + '0';
 174   1         GUI_WriteASCII(60, 170, stemp[0], 0x7fff, 0x0000); 
 175   1         GUI_WriteASCII(70, 170, stemp[1], 0x7fff, 0x0000);  
 176   1         GUI_WriteASCII(80, 170, stemp[2], 0x7fff, 0x0000);
 177   1         GUI_WriteASCII(90, 170, stemp[3], 0x7fff, 0x0000); 
 178   1         //摄氏度符号
C51 COMPILER V9.56.0.0   CALTIMEDISPLAY                                                    07/25/2017 16:46:23 PAGE 4   

 179   1         TFT_SetWindow(105,170,120, 193);
 180   1          for (k=0; k<48; k++)
 181   1          {
 182   2            color = table[k];
 183   2            for (j=0; j<8; j++) 
 184   2            {
 185   3              if ((color&0x80) == 0x80)
 186   3              {
 187   4                TFT_WriteColor(0x7fff);
 188   4              }             
 189   3              else
 190   3              {
 191   4                TFT_WriteColor(0x000);
 192   4              }   
 193   3              color <<= 1;
 194   3            }
 195   2          }  
 196   1       } 
 197          
 198           
 199          /**
 200          *  @name: displayPageSetting
 201          * @description: 显示闹钟响起时的界面
 202           *  @param    :none
 203           *  @return   : none
 204           *  @notice : none
 205           */
 206          void displayPageClock()
 207          {
 208   1                 //开启闹钟
 209   1                  TMOD = 0x10 | 0x01; // 开定时器1模式1
 210   1                  TL1 = 0xcc; // 
 211   1                  TH1 = 0xcc;
 212   1                  ET1 = 1;
 213   1                  TR1 = 1;
 214   1                  pwmCount = 0;
 215   1                  pwmPeriod = PWM_MODE;  
 216   1              TFT_ClearScreen(0x0000);    //清屏  
 217   1            GUI_WriteASCII(65, 100, "STOP", 0xffe0, 0x0000);   //显示关闭按钮 
 218   1          while( 1 )
 219   1          {
 220   2            TFT_paintTimeSet(time);          //右上角显示时间按
 221   2      
 222   2            if(TOUCH_XPT_ReadXY() == 1 )    
 223   2            {
 224   3            /*转化*/
 225   3              x=xpt_xy.x;
 226   3              x=(x-304)*175/3422;
 227   3              y=xpt_xy.y;
 228   3              y=(y-256)*219/3440;     
 229   3              if(x>174)
 230   3              {
 231   4                x=174;
 232   4              }
 233   3              if(y>218)
 234   3              {
 235   4                  y=218;
 236   4              } 
 237   3            if((x>65)&&(x<130)&&(y>97)&&(y<125))    //点击关闭
 238   3            {
 239   4              clockTag = 0;
 240   4              TR1 = 0;
C51 COMPILER V9.56.0.0   CALTIMEDISPLAY                                                    07/25/2017 16:46:23 PAGE 5   

 241   4              ET1 = 0;
 242   4              PWM = 0;
 243   4              TFT_ClearScreen(0x0000);    //清屏
 244   4              break;
 245   4            }
 246   3          }
 247   2            else if( judge() == 1)            //晃动关闭
 248   2            {
 249   3              clockTag = 0;
 250   3              TR1 = 0;
 251   3              ET1 = 0;
 252   3              PWM = 0;
 253   3              TFT_ClearScreen(0x0000);    //清屏
 254   3              break;
 255   3            }     
 256   2        }
 257   1      }
 258          
 259           


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1211    ----
   CONSTANT SIZE    =     85    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      13
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
