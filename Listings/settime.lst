C51 COMPILER V9.56.0.0   SETTIME                                                           07/25/2017 16:46:25 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE SETTIME
OBJECT MODULE PLACED IN .\Objects\settime.obj
COMPILER INVOKED BY: F:\keil51\C51\BIN\C51.EXE settime.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\se
                    -ttime.lst) TABS(2) OBJECT(.\Objects\settime.obj)

line level    source

   1          /***************************************************************************************
   2           *  FileName          : settime.c
   3           *  CopyRight         : 
   4           *  ModuleName          :  
   5           *
   6           *  CPU             :
   7           *  RTOS            :
   8           *
   9           *  Create Data         : 
  10           *  Author/Corportation     :  caiyinmao
  11           *
  12           *  Abstract Description    :    设置时间
  13           *
  14           *--------------------------------Revision History--------------------------------------
  15           *  No  version   Data      Revised By      Item      Description
  16           *  
  17           *
  18           ***************************************************************************************/
  19          
  20          
  21          /**************************************************************
  22          * Debug switch Section
  23          **************************************************************/
  24          
  25          
  26          /**************************************************************
  27          * Include File Section
  28          **************************************************************/
  29          #include<reg52.h>
  30          #include "clock.h"    //引用全局变量time
  31          #include "calTimeDisplay.h"
  32          #include "touch.h"
  33          #include "paintTFT.h"
  34          #include "GUI.h"
  35          #include "lcd_driver.h"
  36          
  37          /**************************************************************
  38          * Macro Define Section
  39          **************************************************************/
  40          
  41          /**************************************************************
  42          * Struct Define Section
  43          **************************************************************/
  44          
  45          
  46          /**************************************************************
  47          * Prototype Declare Section
  48          **************************************************************/
  49          
  50          
  51          /**************************************************************
  52          * Global Variable Declare Section
  53          **************************************************************/
  54          
C51 COMPILER V9.56.0.0   SETTIME                                                           07/25/2017 16:46:25 PAGE 2   

  55          
  56          /**************************************************************
  57          * File Static Variable Define Section
  58          **************************************************************/
  59          
  60          /**************************************************************
  61          * Function Define Section
  62          **************************************************************/
  63          
  64          /**
  65          *  @name: void setTime
  66          * @description:  调整时间
  67          * @param    :none
  68           *  @return   : none
  69           *  @notice : none
  70           */
  71          void setTime()
  72          {
  73   1        uchar num, tag = 0;
  74   1        ET0=0;    //关闭定时器，停止走时
  75   1            /*屏上数字部分检测（设置页面）*/   //不需要清屏         
  76   1        i = 0;
  77   1        while(1) 
  78   1         {
  79   2          if(TOUCH_XPT_ReadXY() == 1)   
  80   2          {
  81   3            /*转化*/
  82   3            x=xpt_xy.x;
  83   3            x=(x-304)*175/3422;
  84   3            y=xpt_xy.y;
  85   3            y=(y-256)*219/3440;     
  86   3            if(x>174)
  87   3            {
  88   4              x=174;
  89   4            }
  90   3            if(y>218)
  91   3            {
  92   4                y=218;
  93   4            }
  94   3            //设置时间 
  95   3            if((x>115)&&(y>45)&&(y<85))   //0
  96   3            {
  97   4              num = 0;
  98   4              tag = 1;
  99   4            }
 100   3            else if((x<60)&&(y>95)&&(y<135))    //1
 101   3            {
 102   4              num = 1;
 103   4              tag = 1;
 104   4            }
 105   3            else if((x>70)&&(x<105)&&(y>95)&&(y<135)) //2
 106   3            {
 107   4              num = 2;
 108   4              tag = 1;
 109   4            }
 110   3            else if((x>115)&&(y>95)&&(y<135))  //3
 111   3            {
 112   4              num = 3;
 113   4              tag = 1;
 114   4            }
 115   3            else if((x<60)&&(y>145)&&(y<165))   //4
 116   3            {
C51 COMPILER V9.56.0.0   SETTIME                                                           07/25/2017 16:46:25 PAGE 3   

 117   4              num = 4;
 118   4              tag = 1;
 119   4            }
 120   3            else if((x>70)&&(x<105)&&(y>145)&&(y<165)) //5
 121   3            {
 122   4              num = 5;
 123   4              tag = 1;
 124   4            }
 125   3            else if((x>115)&&(y>145)&&(y<165)) //6
 126   3            {
 127   4              num = 6;
 128   4              tag = 1;
 129   4            }
 130   3            else if((x<60)&&(y>175)&(y<205))    //7
 131   3            {
 132   4              num  = 7;
 133   4              tag = 1;
 134   4            }
 135   3            else if((x>70)&&(x<105)&&(y>175)&&(y<205)) //8
 136   3            {
 137   4              num = 8;
 138   4              tag = 1;
 139   4            }
 140   3            else if((x>115)&&(y>175)&&(y<205)) //9
 141   3            {
 142   4              num = 9;
 143   4              tag = 1;
 144   4            }                                                             
 145   3            else if((x<55)&&(y<24))  //左上角
 146   3            {
 147   4              ET0=1;
 148   4              break;   //退出循环       
 149   4            }
 150   3            if( tag == 1 )       //判断按键是否有效
 151   3            {
 152   4              tag = 0;
 153   4             switch(i)
 154   4              {
 155   5                case 0:
 156   5                   if( num < 3 )
 157   5                   {
 158   6                      time.hour = time.hour % 10 + num * 10;
 159   6                     i++;
 160   6                   }               
 161   5                    break;
 162   5                case 1: 
 163   5                   if( num < 4 || time.hour < 20) 
 164   5                   {
 165   6                      time.hour =time.hour - time.hour % 10 + num;
 166   6                     i++; 
 167   6                   }              
 168   5                    break;
 169   5              case 2: 
 170   5                   if( num < 6 )
 171   5                   {
 172   6                      time.minute = time.minute % 10 + num * 10;
 173   6                     i++;
 174   6                   }  
 175   5                    break;
 176   5              case 3:
 177   5                   time.minute =time.minute - time.minute % 10 + num;
 178   5                  i++;
C51 COMPILER V9.56.0.0   SETTIME                                                           07/25/2017 16:46:25 PAGE 4   

 179   5                    break;
 180   5              case 4: 
 181   5                   if( num < 6 )
 182   5                   {
 183   6                      time.second = time.second % 10 + num * 10;
 184   6                     i++;
 185   6                   }           
 186   5                    break;
 187   5                case 5: 
 188   5                    time.second =time.second - time.second % 10 + num;
 189   5                    i++;
 190   5                    break;
 191   5              }
 192   4             TFT_paintTimeSet(time);           //显示设置的值
 193   4            if(i==6)  //如果时分秒都赋值完毕则可以重新赋值
 194   4            {
 195   5              i=0;
 196   5            }       
 197   4            }     
 198   3          } 
 199   2        }
 200   1      }
 201          
 202          
 203          /**
 204          *  @name: void setClockTime
 205          * @description:  调整闹钟时间
 206          * @param    :none
 207           *  @return   : none
 208           *  @notice : none
 209           */
 210          void setClockTime()
 211          {
 212   1        uchar num, tag = 0;
 213   1            /*屏上数字部分检测（设置页面）*/   //不需要清屏         
 214   1        i = 0;
 215   1        while(1) 
 216   1         {
 217   2          if(TOUCH_XPT_ReadXY() == 1)   
 218   2          {
 219   3            /*转化*/
 220   3            x=xpt_xy.x;
 221   3            x=(x-304)*175/3422;
 222   3            y=xpt_xy.y;
 223   3            y=(y-256)*219/3440;     
 224   3            if(x>174)
 225   3            {
 226   4              x=174;
 227   4            }
 228   3            if(y>218)
 229   3            {
 230   4                y=218;
 231   4            }
 232   3            //设置时间 
 233   3            if((x>115)&&(y>45)&&(y<85))   //0
 234   3            {
 235   4              num = 0;
 236   4              tag = 1;
 237   4            }
 238   3            else if((x<60)&&(y>95)&&(y<135))    //1
 239   3            {
 240   4              num = 1;
C51 COMPILER V9.56.0.0   SETTIME                                                           07/25/2017 16:46:25 PAGE 5   

 241   4              tag = 1;
 242   4            }
 243   3            else if((x>70)&&(x<105)&&(y>95)&&(y<135)) //2
 244   3            {
 245   4              num = 2;
 246   4              tag = 1;
 247   4            }
 248   3            else if((x>115)&&(y>95)&&(y<135))  //3
 249   3            {
 250   4              num = 3;
 251   4              tag = 1;
 252   4            }
 253   3            else if((x<60)&&(y>145)&&(y<165))   //4
 254   3            {
 255   4              num = 4;
 256   4              tag = 1;
 257   4            }
 258   3            else if((x>70)&&(x<105)&&(y>145)&&(y<165)) //5
 259   3            {
 260   4              num = 5;
 261   4              tag = 1;
 262   4            }
 263   3            else if((x>115)&&(y>145)&&(y<165)) //6
 264   3            {
 265   4              num = 6;
 266   4              tag = 1;
 267   4            }
 268   3            else if((x<60)&&(y>175)&(y<205))    //7
 269   3            {
 270   4              num  = 7;
 271   4              tag = 1;
 272   4            }
 273   3            else if((x>70)&&(x<105)&&(y>175)&&(y<205)) //8
 274   3            {
 275   4              num = 8;
 276   4              tag = 1;
 277   4            }
 278   3            else if((x>115)&&(y>175)&&(y<205)) //9
 279   3            {
 280   4              num = 9;
 281   4              tag = 1;
 282   4            }                                                             
 283   3            else if((x<55)&&(y<24))  //左上角
 284   3            {
 285   4              clockTag = 0;             //关闭闹钟
 286   4              break;   //退出循环       
 287   4            }
 288   3            else if((x>100)&&(y<24))   //左上角
 289   3            {
 290   4              clockTag = 1;         //开启闹钟
 291   4              break;   //退出循环       
 292   4            }
 293   3            if( tag == 1 )       //判断按键是否有效
 294   3            {
 295   4              tag = 0;
 296   4             switch(i)
 297   4              {
 298   5                case 0:
 299   5                   if( num < 3 )
 300   5                   {
 301   6                      timeclock.hour = timeclock.hour % 10 + num * 10;
 302   6                     i++;
C51 COMPILER V9.56.0.0   SETTIME                                                           07/25/2017 16:46:25 PAGE 6   

 303   6                   }               
 304   5                    break;
 305   5                case 1: 
 306   5                   if( num < 4 || timeclock.hour < 20) 
 307   5                   {
 308   6                      timeclock.hour =timeclock.hour - timeclock.hour % 10 + num;
 309   6                     i++; 
 310   6                   }              
 311   5                    break;
 312   5              case 2: 
 313   5                   if( num < 6 )
 314   5                   {
 315   6                      timeclock.minute = timeclock.minute % 10 + num * 10;
 316   6                     i++;
 317   6                   }  
 318   5                    break;
 319   5              case 3:
 320   5                   timeclock.minute =timeclock.minute - timeclock.minute % 10 + num;
 321   5                  i++;
 322   5                    break;
 323   5              case 4: 
 324   5                   if( num < 6 )
 325   5                   {
 326   6                      timeclock.second = timeclock.second % 10 + num * 10;
 327   6                     i++;
 328   6                   }           
 329   5                    break;
 330   5                case 5: 
 331   5                    timeclock.second =timeclock.second - timeclock.second % 10 + num;
 332   5                    i++;
 333   5                    break;
 334   5              }
 335   4              TFT_paintTimeSet(timeclock);           //显示设置的值
 336   4            if(i==6)  //如果时分秒都赋值完毕则可以重新赋值
 337   4            {
 338   5              i=0;
 339   5            }       
 340   4            }     
 341   3          } 
 342   2        }
 343   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2238    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
